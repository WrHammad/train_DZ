<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ù‚Ø·Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„ | Ù†Ø³Ø®Ø© Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@500;700;900&display=swap');

        :root {
            --primary: #006633;
            --primary-dark: #004d26;
            --secondary: #D21034;
            --accent: #f59e0b;
            --bg-body: #f1f5f9;
            --surface: #ffffff;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --header-h: 50px;
            --train-h: 90px;
            --cards-h: 180px; /* Ø§Ø±ØªÙØ§Ø¹ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø«Ø§Ø¨ØªØ© ØªÙ‚Ø±ÙŠØ¨ÙŠ */
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0; padding: 0;
            height: 100vh; height: 100dvh; /* Ø¯Ø¹Ù… Ø¯Ù‚ÙŠÙ‚ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        /* --- 1. Ø§Ù„Ø±Ø£Ø³ Ø§Ù„Ù…ØµØºØ± (Compact Header) --- */
        header {
            height: var(--header-h);
            background: var(--surface);
            padding: 0 15px;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px solid #e2e8f0;
            flex-shrink: 0; z-index: 20;
        }
        
        .header-title { font-size: 0.9rem; color: var(--primary); font-weight: 900; display:flex; gap:5px; align-items:center;}
        
        .lives-badge {
            background: #fff1f2; color: var(--secondary);
            padding: 2px 10px; border-radius: 20px;
            font-weight: 800; font-size: 0.85rem;
            display: flex; align-items: center; gap: 4px;
            border: 1px solid #fecdd3;
        }

        /* --- 2. Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù‚Ø·Ø§Ø± Ø§Ù„Ù…Ø¶ØºÙˆØ·Ø© (Compact Train) --- */
        .train-container {
            height: var(--train-h);
            background: linear-gradient(180deg, #e0f2fe 0%, #f0f9ff 100%);
            position: relative;
            flex-shrink: 0;
            display: flex; align-items: center; justify-content: center;
            border-bottom: 1px solid #bfdbfe;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
            overflow: hidden;
        }

        .rail-track {
            position: relative; width: 90%; height: 10px;
            background: #cbd5e1; border-radius: 5px;
            display: flex; align-items: center; justify-content: space-between;
            flex-direction: row-reverse;
        }
        
        .track-progress {
            position: absolute; right: 0; top: 0; bottom: 0; width: 0%; 
            background: var(--primary); border-radius: 5px; z-index: 1;
            transition: width 0.8s ease;
        }

        .station {
            width: 32px; height: 32px;
            background: var(--surface); border: 3px solid #94a3b8;
            border-radius: 50%; z-index: 5;
            display: grid; place-items: center;
            font-weight: 800; font-size: 0.9rem; color: #94a3b8;
            transition: all 0.4s;
            position: relative;
        }
        
        /* ØªØ³Ù…ÙŠØ§Øª Ø§Ù„Ù…Ø­Ø·Ø§Øª ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹ */
        .station::after {
            content: attr(data-label); position: absolute; bottom: -18px;
            font-size: 0.6rem; color: var(--text-muted); font-weight: 600;
            white-space: nowrap;
        }

        .station.active {
            border-color: var(--secondary); color: var(--secondary);
            transform: scale(1.2); background: #fff;
            box-shadow: 0 0 0 3px rgba(210, 16, 52, 0.15);
        }
        .station.passed {
            background: var(--primary); border-color: var(--primary);
            color: white; transform: scale(1);
        }

        #train-icon {
            position: absolute; top: -35px; right: 0;
            font-size: 2.5rem; z-index: 10;
            transform: translateX(50%);
            transition: right 0.8s ease;
            filter: drop-shadow(1px 3px 2px rgba(0,0,0,0.2));
        }

        /* --- 3. Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨ (Scrollable Area) --- */
        .game-scroll-area {
            flex: 1;
            overflow-y: auto;
            /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ø³ÙÙ„ÙŠØ© Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… ØªØºØ·ÙŠØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù„Ù„Ù…Ø­ØªÙˆÙ‰ */
            padding: 20px 15px 220px; 
            background: var(--bg-body);
            display: flex; flex-direction: column;
            scroll-behavior: smooth;
        }

        .level-info {
            background: white; padding: 12px; border-radius: 12px;
            margin-bottom: 20px; border-right: 4px solid var(--primary);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            flex-shrink: 0;
        }
        .level-info h2 { margin: 0 0 5px; font-size: 1rem; color: var(--text-main); }
        .level-info p { margin: 0; font-size: 0.85rem; color: var(--text-muted); }

        .slots-container { 
            display: flex; flex-direction: column; 
            /* ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ù„ØªØ¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ ÙˆØªØ³Ù…Ø­ Ø¨Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ */
            justify-content: flex-start; 
            flex-grow: 1; min-height: 150px;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø®Ø§Ù†Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø© Ø§Ù„Ù†Ø´Ø·Ø© */
        .slot {
            background: white; border: 2px dashed #cbd5e1;
            border-radius: 16px; min-height: 100px;
            display: flex; align-items: center;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            margin: 0 auto; width: 100%;
            position: relative;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .slot.active {
            border-color: var(--primary);
            background: #fff;
            transform: scale(1.02);
            box-shadow: 0 10px 25px -5px rgba(0, 102, 51, 0.15);
            border-style: solid;
            animation: slideIn 0.4s ease-out;
        }
        @keyframes slideIn { from {opacity:0; transform: translateY(20px);} to {opacity:1; transform: translateY(0);} }

        .slot.filled {
            border-color: #22c55e; background: #dcfce7;
            border-style: solid; transform: scale(1);
        }

        .slot-num {
            width: 50px; height: 100%; min-height: 100px; 
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: #f1f5f9; border-radius: 0 14px 14px 0;
            font-weight: 800; color: #64748b; font-size: 1.1rem;
            border-left: 2px solid #e2e8f0;
        }
        .slot-num small { font-size: 0.6rem; font-weight: 600; color: #94a3b8; margin-top: 4px; }

        .slot-text {
            flex: 1; display: grid; place-items: center;
            padding: 10px 15px; text-align: center;
            font-weight: 700; color: var(--primary-dark); font-size: 1rem;
            line-height: 1.4;
        }
        
        /* Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ */
        .slot.active::before {
            content: 'ğŸ‘‡ Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©'; 
            position: absolute; bottom: -25px; left: 0; right: 0;
            text-align: center; font-size: 0.8rem; color: var(--primary);
            opacity: 0.8; animation: bounceHint 1.5s infinite;
        }
        @keyframes bounceHint { 0%, 100% {transform:translateY(0);} 50% {transform:translateY(3px);} }

        /* --- 4. Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø«Ø§Ø¨ØªØ© (Fixed Bottom Sheet) --- */
        .cards-sheet {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: white;
            padding: 10px 15px 20px; /* Ù…Ø³Ø§Ø­Ø© Ù„Ù„Ø£Ø¬Ù‡Ø²Ø© Ø°Ø§Øª Ø§Ù„Ø­ÙˆØ§Ù Ø§Ù„Ù…Ø³ØªØ¯ÙŠØ±Ø© */
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            border-radius: 20px 20px 0 0;
            z-index: 50;
            max-height: 35vh; /* Ø£Ù‚ØµÙ‰ Ø§Ø±ØªÙØ§Ø¹ 35% Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø© */
            overflow-y: auto;
        }
        
        .sheet-handle {
            width: 40px; height: 4px; background: #e2e8f0;
            border-radius: 2px; margin: 0 auto 10px;
        }

        .cards-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
        }

        .option-card {
            background: white; border: 1px solid #e2e8f0;
            border-bottom: 3px solid #cbd5e1;
            border-radius: 10px; padding: 10px 5px;
            text-align: center; font-size: 0.8rem; font-weight: 700;
            color: #334155; cursor: pointer;
            min-height: 50px; display: grid; place-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
            transition: transform 0.1s;
        }
        .option-card:active {
            transform: translateY(2px); border-bottom-width: 1px;
            background: #f8fafc;
        }

        /* --- 5. Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© (Start/End) --- */
        .overlay {
            position: fixed; inset: 0; z-index: 100;
            background: rgba(255,255,255,0.95);
            display: none; flex-direction: column; 
            justify-content: center; align-items: center;
            padding: 20px; text-align: center;
        }
        .overlay.active { display: flex; animation: fadeIn 0.3s; }
        
        .start-icon { font-size: 4rem; margin-bottom: 10px; }
        .start-title { font-size: 1.8rem; color: var(--text-main); margin: 0; font-weight: 900; }
        .start-desc { font-size: 0.95rem; color: var(--text-muted); margin: 10px 0 20px; line-height: 1.5; max-width: 300px;}
        
        .btn-action {
            width: 100%; max-width: 280px;
            padding: 14px; border-radius: 50px; border: none;
            background: var(--primary); color: white;
            font-size: 1.1rem; font-weight: 800;
            box-shadow: 0 4px 15px rgba(0, 102, 51, 0.3);
            cursor: pointer;
        }
        .btn-action:active { transform: scale(0.98); }

        /* Toast */
        .toast {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.9);
            background: rgba(0,0,0,0.85); color: white; padding: 12px 24px;
            border-radius: 50px; font-weight: 700; font-size: 0.9rem;
            opacity: 0; pointer-events: none; z-index: 200;
            transition: all 0.2s; text-align: center; width: max-content;
        }
        .toast.show { opacity: 1; transform: translate(-50%, -50%) scale(1); }

    </style>
</head>
<body>

    <div id="toast" class="toast"></div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©: Ø¨Ø³ÙŠØ·Ø© Ø¬Ø¯Ø§Ù‹ Ù„ØªÙ†Ø§Ø³Ø¨ Ø£ØµØºØ± Ø§Ù„Ø´Ø§Ø´Ø§Øª -->
    <div id="start-screen" class="overlay active">
        <div class="start-icon">ğŸš‚</div>
        <h1 class="start-title">Ù‚Ø·Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„</h1>
        <p class="start-desc">Ø±Ø­Ù„Ø© 11 Ø¯ÙŠØ³Ù…Ø¨Ø± 1960.<br>Ø±ØªØ¨ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠØ© Ù„ØªØµÙ„ Ø¨Ø§Ù„Ù‚Ø·Ø§Ø± Ø¥Ù„Ù‰ Ù…Ø­Ø·Ø© Ø§Ù„Ø­Ø±ÙŠØ©.</p>
        
        <div style="display:flex; gap:15px; margin-bottom:25px; font-size:0.85rem; color:#64748b; background:#f1f5f9; padding:8px 15px; border-radius:20px;">
            <span>ğŸ¯ 4 Ù…Ø­Ø·Ø§Øª</span>
            <span>â¤ ÙØ±ØµØªØ§Ù†</span>
        </div>

        <button class="btn-action" onclick="Game.start()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¢Ù† ğŸš©</button>
    </div>

    <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„Ø¹Ø¨ -->
    <div id="game-ui" style="display:none; flex-direction:column; height:100%;">
        
        <header>
            <div class="header-title">
                <span>ğŸš‚</span>
                <span>Ù‚Ø·Ø§Ø± Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„</span>
            </div>
            <div class="lives-badge">
                <span>â¤</span> <span id="lives">2</span>
            </div>
        </header>

        <div class="train-container">
            <div class="rail-track">
                <div class="track-progress" id="track-fill"></div>
                <div class="station" id="st-4" data-label="Ø§Ù„Ù†Ù‡Ø§ÙŠØ©">4</div>
                <div class="station" id="st-3" data-label="">3</div>
                <div class="station" id="st-2" data-label="">2</div>
                <div class="station active" id="st-1" data-label="Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©">1</div>
                <div id="train-icon">ğŸš‚</div>
            </div>
        </div>

        <div class="game-scroll-area">
            <div class="level-info">
                <h2 id="lvl-title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø±Ø­Ù„Ø©</h2>
                <p id="lvl-desc">ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù…Ù†Ùƒ Ù‡Ù†Ø§.</p>
            </div>
            
            <div id="slots-container" class="slots-container">
                <!-- Ø³ØªØ¸Ù‡Ø± Ø®Ø§Ù†Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· Ù‡Ù†Ø§ -->
            </div>
        </div>

        <div class="cards-sheet">
            <div class="sheet-handle"></div>
            <div id="cards-container" class="cards-grid">
                <!-- Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </div>
        </div>

    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ÙÙˆØ² -->
    <div id="win-screen" class="overlay">
        <div class="start-icon">ğŸ‡©ğŸ‡¿</div>
        <h1 class="start-title" style="color:var(--primary);">Ù…Ø¨Ø±ÙˆÙƒ ÙŠØ§ Ø¨Ø·Ù„!</h1>
        <p class="start-desc">Ù„Ù‚Ø¯ Ø£ÙˆØµÙ„Øª Ø§Ù„Ù‚Ø·Ø§Ø± Ø¥Ù„Ù‰ Ù…Ø­Ø·Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„ Ø¨Ø³Ù„Ø§Ù….</p>
        <button class="btn-action" onclick="location.reload()">Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ â†º</button>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø®Ø³Ø§Ø±Ø© -->
    <div id="lose-screen" class="overlay">
        <div class="start-icon" style="filter:grayscale(1);">ğŸš‚</div>
        <h1 class="start-title" style="color:var(--secondary);">ØªÙˆÙ‚Ù Ø§Ù„Ù‚Ø·Ø§Ø±!</h1>
        <p class="start-desc">Ù†ÙØ°Øª Ù…Ø­Ø§ÙˆÙ„Ø§ØªÙƒ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø·Ø©. Ù„Ø§ ØªÙŠØ£Ø³!</p>
        <button class="btn-action" style="background:#475569;" onclick="location.reload()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© â†º</button>
    </div>

    <script>
        const Levels = [
            {
                type: 'seq', title: "Ø§Ù„ØªØ³Ù„Ø³Ù„ Ø§Ù„Ø²Ù…Ù†ÙŠ", desc: "Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„ØªØ§Ø±ÙŠØ®:",
                slots: ["04 Ù†ÙˆÙÙ…Ø¨Ø±", "09 Ø¯ÙŠØ³Ù…Ø¨Ø±", "10 Ø¯ÙŠØ³Ù…Ø¨Ø±", "11 Ø¯ÙŠØ³Ù…Ø¨Ø±", "20 Ø¯ÙŠØ³Ù…Ø¨Ø±"],
                ans: [1, 2, 3, 4, 5],
                items: [
                    {id:1, txt:"Ù…Ø´Ø±ÙˆØ¹ Ø¯ÙŠØºÙˆÙ„"}, {id:2, txt:"Ø§Ù†Ø·Ù„Ø§Ù‚ Ø§Ù„Ø´Ø±Ø§Ø±Ø©"},
                    {id:3, txt:"Ø§ØªØ³Ø§Ø¹ Ø§Ù„Ù…Ø¸Ø§Ù‡Ø±Ø§Øª"}, {id:4, txt:"Ù…Ø¸Ø§Ù‡Ø±Ø§Øª Ø§Ù„Ø¹Ø§ØµÙ…Ø©"}, {id:5, txt:"Ø§Ù†ØªØµØ§Ø± Ø£Ù…Ù…ÙŠ"}
                ]
            },
            {
                type: 'seq', title: "Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ", desc: "Ø£ÙŠÙ† Ø¨Ø¯Ø£Øª ÙˆÙƒÙŠÙ Ø§Ù†ØªØ´Ø±ØªØŸ",
                slots: ["Ø§Ù„Ø§Ù†Ø·Ù„Ø§Ù‚", "Ø§Ù„ÙŠÙˆÙ… 1", "Ø§Ù„ÙŠÙˆÙ… 2", "Ø§Ù„ÙŠÙˆÙ… 3", "Ø§Ù„ØªØ¹Ù…ÙŠÙ…"],
                ans: [1, 2, 3, 4, 5],
                items: [
                    {id:1, txt:"Ø¹ÙŠÙ† ØªÙ…ÙˆØ´Ù†Øª"}, {id:2, txt:"ØªÙ„Ù…Ø³Ø§Ù†"}, {id:3, txt:"ÙˆÙ‡Ø±Ø§Ù†"},
                    {id:4, txt:"Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø¹Ø§ØµÙ…Ø©"}, {id:5, txt:"Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª"}
                ]
            },
            {
                type: 'quiz', title: "Ø±Ù…ÙˆØ² Ø§Ù„Ø³ÙŠØ§Ø¯Ø©", desc: "Ù…Ø§ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø°ÙŠ Ø±ÙØ¹Ù‡ Ø§Ù„Ø´Ø¹Ø¨ Ø¨Ù‚ÙˆØ©ØŸ",
                q: "Ù…Ø§ Ù‡Ùˆ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø°ÙŠ Ø£Ø¯Ù‡Ø´ Ø§Ù„ØµØ­Ø§ÙØ© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©ØŸ",
                ans: 'B',
                opts: [{id:'A', txt:"Ù„Ø§ÙØªØ§Øª Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©"}, {id:'B', txt:"Ø§Ù„Ø¹Ù„Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ ğŸ‡©ğŸ‡¿"}, {id:'C', txt:"ØµÙˆØ± Ø¯ÙŠØºÙˆÙ„"}]
            },
            {
                type: 'seq', title: "Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø¸Ø§Ù‡Ø±Ø§Øª", desc: "Ù…Ø§Ø°Ø§ Ø­Ù‚Ù‚Øª Ù‡Ø°Ù‡ Ø§Ù„ØªØ¶Ø­ÙŠØ§ØªØŸ",
                slots: ["Ø³ÙŠØ§Ø³ÙŠØ§Ù‹", "Ø¹Ø³ÙƒØ±ÙŠØ§Ù‹", "Ø¯Ø¨Ù„ÙˆÙ…Ø§Ø³ÙŠØ§Ù‹", "Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ§Ù‹", "Ø§Ù„Ù†ØªÙŠØ¬Ø©"],
                ans: [1, 2, 3, 4, 5],
                items: [
                    {id:1, txt:"Ø³Ù‚ÙˆØ· 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± ÙØ±Ù†Ø³ÙŠØ©'"}, {id:2, txt:"ÙÙƒ Ø§Ù„Ø®Ù†Ø§Ù‚ Ø¹Ù† Ø§Ù„Ø¬Ø¨Ù„"},
                    {id:3, txt:"Ø§Ø¹ØªØ±Ø§Ù Ø§Ù„Ø£Ù…Ù… Ø§Ù„Ù…ØªØ­Ø¯Ø©"}, {id:4, txt:"Ø¥Ø¬Ø¨Ø§Ø± ÙØ±Ù†Ø³Ø§ Ø¹Ø§Ù„ØªÙØ§ÙˆØ¶"}, {id:5, txt:"Ø­ØªÙ…ÙŠØ© Ø§Ù„Ø§Ø³ØªÙ‚Ù„Ø§Ù„"}
                ]
            }
        ];

        const Game = {
            lvl: 0, step: 0, tries: 2,

            start() {
                document.getElementById('start-screen').classList.remove('active');
                document.getElementById('game-ui').style.display = 'flex';
                this.load(0);
            },

            load(idx) {
                this.lvl = idx; this.step = 0; this.tries = 2;
                this.renderUI();
                this.updateTrainUI();
            },

            renderUI() {
                const data = Levels[this.lvl];
                document.getElementById('lvl-title').innerText = data.title;
                document.getElementById('lvl-desc').innerText = data.desc;
                document.getElementById('lives').innerText = this.tries;
                
                const cardsCont = document.getElementById('cards-container');
                cardsCont.innerHTML = '';

                // Scroll slots to top
                document.querySelector('.game-scroll-area').scrollTop = 0;

                // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª (Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª)
                if(data.type === 'seq') {
                    // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø£ÙˆÙ„ ÙÙ‚Ø·
                    this.renderCurrentSlot();

                    // Ø®Ù„Ø· Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
                    let arr = [...data.items].sort(()=>Math.random()-0.5);
                    arr.forEach(item => {
                        let div = document.createElement('div');
                        div.className = 'option-card'; div.innerText = item.txt;
                        div.onclick = (e) => this.check(item, e.target);
                        cardsCont.appendChild(div);
                    });
                    cardsCont.style.gridTemplateColumns = "1fr 1fr";
                } else {
                    // Quiz Mode
                    const slotsCont = document.getElementById('slots-container');
                    slotsCont.innerHTML = `
                    <div class="slot active" style="padding:15px; min-height:120px; text-align:center; border-color:var(--primary);">
                        <h3 style="margin:0; font-size:1.1rem; line-height:1.5; color:var(--text-main);">${data.q}</h3>
                    </div>`;
                    
                    data.opts.forEach(opt => {
                        let div = document.createElement('div');
                        div.className = 'option-card'; div.innerText = opt.txt;
                        div.style.minHeight = "60px";
                        div.onclick = () => this.checkQuiz(opt.id);
                        cardsCont.appendChild(div);
                    });
                    cardsCont.style.gridTemplateColumns = "1fr";
                }
            },

            renderCurrentSlot() {
                const data = Levels[this.lvl];
                const slotsCont = document.getElementById('slots-container');
                slotsCont.innerHTML = ''; // Ù…Ø³Ø­ Ø§Ù„Ù‚Ø¯ÙŠÙ…

                if(this.step < data.slots.length) {
                    const label = data.slots[this.step];
                    // Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø§Ù†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙ‚Ø·
                    slotsCont.innerHTML = `
                    <div class="slot active" id="current-slot">
                        <div class="slot-num">
                            ${this.step + 1}
                            <small>Ù…Ù† ${data.slots.length}</small>
                        </div>
                        <div class="slot-text" data-label="${label}">
                            <div style="font-size:0.8rem; color:#94a3b8; margin-bottom:5px;">${label}</div>
                            <div id="slot-answer-txt">ØŸØŸØŸ</div>
                        </div>
                    </div>`;
                }
            },

            check(item, el) {
                const correct = Levels[this.lvl].ans[this.step];
                
                if(item.id === correct) {
                    this.toast("âœ… Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©");
                    
                    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø®Ø§Ù†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„ØªØ¸Ù‡Ø± Ø£Ù†Ù‡Ø§ Ù…Ù…ØªÙ„Ø¦Ø©
                    const slot = document.getElementById('current-slot');
                    document.getElementById('slot-answer-txt').innerText = item.txt;
                    document.getElementById('slot-answer-txt').style.color = "#166534";
                    slot.classList.remove('active'); 
                    slot.classList.add('filled');
                    
                    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©
                    el.style.opacity = '0'; el.style.pointerEvents = 'none';
                    
                    this.step++;
                    
                    // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø«Ù… Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ Ø£Ùˆ Ø§Ù„Ù…Ø­Ø·Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
                    setTimeout(() => {
                        if(this.step >= Levels[this.lvl].slots.length) {
                            this.nextLvl();
                        } else {
                            this.renderCurrentSlot(); // Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ
                        }
                    }, 600); // ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù†ØªÙŠØ¬Ø©

                } else {
                    this.fail();
                }
            },

            checkQuiz(id) {
                if(id === Levels[this.lvl].ans) {
                    this.toast("âœ… Ù…Ù…ØªØ§Ø²");
                    setTimeout(() => this.nextLvl(), 500);
                } else {
                    this.fail();
                }
            },

            fail() {
                this.tries--;
                document.getElementById('lives').innerText = this.tries;
                this.toast("âŒ Ø®Ø·Ø£", "error");
                
                if(this.tries <= 0) {
                    setTimeout(() => document.getElementById('lose-screen').classList.add('active'), 300);
                }
            },

            nextLvl() {
                if(this.lvl < 3) this.load(this.lvl + 1);
                else {
                    this.lvl = 4;
                    this.updateTrainUI();
                    setTimeout(() => document.getElementById('win-screen').classList.add('active'), 500);
                }
            },

            updateTrainUI() {
                let pct = this.lvl * 25;
                if(this.lvl === 4) pct = 100;

                document.getElementById('train-icon').style.right = pct + "%";
                document.getElementById('track-fill').style.width = pct + "%";

                for(let i=1; i<=4; i++) {
                    const st = document.getElementById(`st-${i}`);
                    st.className = 'station';
                    if(i <= this.lvl) { st.classList.add('passed'); st.innerHTML = "âœ”"; }
                    else if(i === this.lvl + 1) { st.classList.add('active'); st.innerHTML = i; }
                    else { st.innerHTML = i; }
                }
            },

            toast(msg, type) {
                const t = document.getElementById('toast');
                t.innerText = msg;
                t.style.background = type === 'error' ? '#ef4444' : '#22c55e';
                t.classList.add('show');
                setTimeout(() => t.classList.remove('show'), 1000);
            }
        };
    </script>
</body>
</html>
